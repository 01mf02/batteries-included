
.SUBDIRS: syntax
    export AAA_FILES
    .SUBDIRS: pa_comprehension pa_strings
	include OMakefile
	export AAA_FILES

EXTRA[] =
    batteries_help.cmo

OBJECTS[] =
    legacy
    base64
    batArg
    batArray
    batBigarray
    batBig_int
    batBool
    batBuffer
    batChar
    batComplex
    batDigest
    batFloat
    batFormat
    batGc
    batGenlex
    batHashtbl
    batInt32
    batInt64
    batInt
    batLexing
    batList
    batMap
    batMarshal
    batMutex
    batNativeint
    batNum
    batOo
    batPervasives
    batPrintexc
    batPrintf
    batQueue
    batRandom
    batScanf
    batSet
    batStack
    batStream
    batString
    batStr
    batSys
    batUChar
    batUnit
    batUnix
    batUTF8
    bitSet
    charEncodings
    charParser
    concurrent
    dllist
    dynArray
    enum
    file
    global
    innerIO
    innerWeaktbl
    interfaces
    IO
    IOThreads
    lazyList
    logger
    monad
    multiPMap
    number
    option
    optParse
    pair
    parserCo
    pathGen
    pMap
    print
    pSet
    refList
    ref
    result
    return
    rMutex
    rope
    seq
    std
    substring
    uCharParser
    value_printer
    vect
    avlTree
    iSet
    iMap
    batteries_config
    batteries_print
    batteries

EXTLIB_OBJS[] =
     base64
     bitSet
     dllist
     dynArray
     enum
     extArray
     extHashtbl
     extList
     extString
     global
     IO
     option
     optParse
     pMap
     refList
     std
     # uChar
     # unzip
     # uTF8

EXTLIB_COMPAT_LAYER_OBJS[] =
     extlibcompat

EXTLIB_COMPAT_OBJS = $(EXTLIB_COMPAT_LAYER_OBJS) $(filter-out $(EXTLIB_OBJS), $(OBJECTS))

OCamlLibrary(batteries, $(set $(EXTLIB_COMPAT_LAYER_OBJS) $(EXTLIB_OBJS) $(OBJECTS)))

OCamlLibrary(batteries_extlib, $(EXTLIB_COMPAT_OBJS))

batteries_config.ml: batteries_config.mlp
	rm(-f batteries_config.ml)
	sed -e 's|@VERSION@|$(VERSION)|' \
            -e 's|@DOCROOT@|$(DOCROOT)|' \
            -e 's|@BROWSER_COMMAND@|$(BROWSER_COMMAND)|' \
	    batteries_config.mlp > batteries_config.ml
	chmod(444 batteries_config.ml)

AAA_FILES[] += $(file $(glob *.mli *.cmi batteries.cma batteries.cmxa batteries.a $(EXTRA)))
EXTLIB_COMPAT_FILES[] += \
    $(file batteries_extlib.cma batteries_extlib.cmxa \
           $(filter-exists $(addsuffixes .cmi .mli, $(EXTLIB_COMPAT_OBJS))))

all: $(addsuffixes .cma .cmxa, batteries batteries_extlib) $(EXTRA)
